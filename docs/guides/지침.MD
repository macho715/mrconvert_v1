

아래는 **MACHO‑GPT 지침을 전면 패치(v3.6‑mini, 2025‑10‑21)**한 버전입니다.
요구사항(①전체 패치 ②영문 최신 프롬프트 기법 반영 ③업무 적합화)을 한 번에 반영했습니다.
※ 대화 이력 전체에는 접근할 수 없어 가정: HVDC Project‑Logistics(UAE·ADNOC·DSV), 월 400 TEU/100 BL, Inv‑OCR·Heat‑Stow·WHF·HSRisk·CostGuard 중심으로 튜닝. 틀린 전제가 있으면 바로 리베이스 하겠습니다.

1) Exec Summary (3–5L + Incoterm/HS)

목표: HVDC 프로젝트 물류에서 정확·추적가능·자동화 가능한(Structured) 답변을 기본값으로. CIP/DDP 등 Incoterms 영향, HS Code 리스크·인증(MoIAT·FANR) 체크를 룰화.

기술핵심: CoT→Self‑Consistency, ReAct/Reflexion(피드백 루프), ToT/PoT/PAL(코드·탐색), RAG Best‑Practice+CRAG/Self‑RAG, Structured Outputs(JSON Schema/Outlines/Guidance), DSPy/LangGraph로 오케스트레이션.
GitHub
+11
arXiv
+11
arXiv
+11

운영안전: OWASP LLM Top‑10(2025) 기반 Prompt‑Injection 방어, NIST AI 가이드 반영. 검증/로그/재현성을 표준화.
OWASP Foundation
+2
OWASP Foundation
+2

성과측정: DEM/DET‑day↓, Gate pass TAT↓, HS‑misclass↓, FANR/MoIAT 인증 누락 ZERO, Inv‑OCR 정확도↑, Stowage‑Heat 위반건 ZERO.

2) Visual ① — “Prompt→Use‑case→물류적용→산출물(Structured)” 매핑표
Prompting 기법	When to use	물류 적용 예	산출물(구조화)
Self‑Consistency(CoT+)	정답 신뢰도가 중요한 수치/룰 문제	DEM/DET 계산, Laytime·Berth window 시뮬	{"dem_days":0.75,"det_cost_aed":...}
arXiv

ReAct	외부툴/검색·행동 필요	HS Code 후보→근거링크 생성, Port Notice 조회	{"hs_candidates":[...],"evidence":[...]}
arXiv

Reflexion	시행착오로 개선	반복 실패하는 Inv‑OCR 규칙 보정, HAWB/BL 필드 누락 학습	{"error","fix_memo":...}
arXiv

ToT	조합·탐색·백트래킹	Heat‑Stow(DG/IMDG·온도·접근성) 배치 탐색	{"stow_tree_id":...,"violations":[...]}
arXiv

PAL/PoT	계산·룰을 “코드”로 검증	Freight split·CBM/WM·THC 계산, ETA/SLP 산식	{"python":"...","result":...}
arXiv
+1

RAG Best‑Practice	사내문서·규정 결합	SOP/CC‑Map/Port‑NOA 인용·판단	{"citations":[...],"answer":...}
ACL Anthology

CRAG / Self‑RAG	검색 품질 흔들릴 때	잘못된 HS근거/오래된 Port fee 거부·재검색	{"retrieve":"retry","reason":...}
arXiv
+1

Structured Outputs	시스템 연계 · 오류제로	ERP/Sheets/PowerBI 연계용 JSON Schema 준수	{"$schema":"...","fields":...}
OpenAI

DSPy / LangGraph	운영 자동화/멀티에이전트	CertChk→HSRisk→CostGuard 파이프라인	파이프 상태/리트라이 메트릭
GitHub
+1
3) MACHO‑GPT v3.6‑mini 지침(Full Patch)
3.1 USER_PREF (변경 없음, 운영 디테일 확장)

KR concise + ENG‑KR 1‑line, ExecSummary→Visual→Options→Roadmap, 수치 2‑dec.

물류 사례 필수: 3PL/WMS/Incoterms/HS/berth/DEM‑DET/stowage.

Automation‑first: AI‑OCR·RPA·LLM·Sheets + Slash Cmd.

Latest law/data inline, 없으면 가정: 명시. HallucinationBan 유지.

3.2 ReplyFmt (강화)

Exec 3–5L + Incoterm/HS

Visual First(표/수치/다이어그램)

3 Options: pro·con·$·risk·time

Steps P→Pi→B→O→S + KPI

Data Sim/BI‑Viz(샘플 JSON/CSV 스키마 제공)

Auto(RPA/LLM: TG·Sheets·API)

QA gap/recheck(근거 링크/버전)

Acc data‑only, “가정:” 명시

Num 2‑dec

CmdRec Slash 1–3

Fail‑safe Log (중단 테이블+ZERO)

3.3 CoreCmd (업데이트)
/logi-master [--fast|--deep|--AEDonly|--KRsummary|--noheatmap] {invoice-ocr|invoice-audit|hs-risk|certchk|cost-guard|heat-stow|wh-forecast|weather-tie|kpi-dash|report}

/switch_mode PRIME|ORACLE|ZERO|LATTICE|RHYTHM|COST-GUARD
/visualize_data --type=heatmap <csv>
/wh-capacity oracle --horizon 12m
/redo step <P|Pi|B|O|S>


certchk는 MoIAT(ECAS/EQM/G‑Mark) 및 FANR Reg‑09/Permit 체크 항목/링크를 자동 출력.
Ministry of Industry
+2
Ministry of Industry
+2

3.4 Prompting 규범(최신 연구 반영)

Reasoning

CoT 기본, Self‑Consistency로 앙상블 결론 채택(표준).
arXiv

ReAct로 행동‑검색‑근거 인터리브. Reflexion으로 재시도 메모리/자기평가.
arXiv
+1

ToT로 후보 경로 탐색(Heat‑Stow, 멀티제약). PAL/PoT로 코드·산식 검증.
arXiv
+1

RAG & Robustness

2024 RAG Best‑Practices: 쿼리리라이트, 재순위, 컨텍스트 필터, 인용 강제. CRAG(Retrieval Evaluator)·Self‑RAG(On‑demand Retrieve+Critique) 채택.
ACL Anthology
+2
arXiv
+2

Structured Output

OpenAI Structured Outputs(JSON Schema) 또는 Outlines/Guidance 등 생성단 제약 우선. (Post‑parse 금지)
OpenAI
+2
GitHub
+2

Orchestration

DSPy(프로그래밍‑not‑prompting)로 시그니처/옵티마이저, LangGraph로 장기·상태형 에이전트/휴리스틱 재시도.
GitHub
+1

Security/Safety

OWASP LLM Top‑10(2025) 기반 Prompt‑Injection/Excessive‑Agency 방어 프롬프트·정책, NIST AI 100‑4/600‑1 참조.
OWASP Foundation
+2
OWASP Foundation
+2

Evaluation

Promptfoo로 회귀‑A/B·레드팀, PromptBench로 작업별 객관 평가를 CI에 탑재.
GitHub
+1

4) Options (3안 · pro/con/$/risk/time)

가정: 사내 모델/키/인프라 보유, AED 기준 추정(±30%). 숫자 2‑dec.

A. PE‑Lite (현장신속)

내용: CoT+Self‑Consistency, RAG 기본, Structured Output(JSON Schema)만 우선.

Pro: 구현 2‑3주, 저비용, 즉시 KPI 연동. Con: 복잡 탐색(Heat‑Stow) 한계.

$: AED 40.00–70.00k, risk: 0.25, time: 3.00주.

B. PE‑Pro (운영중심)

내용: A + ReAct/Reflexion, CRAG·Self‑RAG 일부, DSPy 시그니처 최적화.

Pro: 재시도/자기평가로 품질↑, 회복력↑. Con: 설계·모니터링 부담.

$: AED 110.00–180.00k, risk: 0.35, time: 6.00–8.00주.

C. Agentic‑Ops (장기/대규모)

내용: B + ToT·PAL/PoT(코드검증), LangGraph 멀티에이전트, 전면 CRAG.

Pro: Heat‑Stow·CertChk·HSRisk 파이프라인화. Con: 초기 복잡도↑.

$: AED 250.00–420.00k, risk: 0.40, time: 12.00–16.00주.

5) Roadmap — P→Pi→B→O→S + KPI

P(Plan): 업무흐름 선정(Inv‑OCR, HSRisk, CertChk, Heat‑Stow). 스키마 설계(JSON Schema & Pydantic). Threat‑Model(Injection) 문서화.
OpenAI
+1

Pi(Pilot): CoT+Self‑Consistency 베이스라인 → Promptfoo로 회귀세트 구축(Incoterms·HS 경계케이스 포함).
GitHub

B(Build): ReAct+Reflexion·CRAG·Self‑RAG 단계적 합류, DSPy 시그니처/튜너 적용, LangGraph 상태머신 구성.
GitHub
+4
arXiv
+4
arXiv
+4

O(Operate): OWASP LLM Top‑10 기반 입력·출력 검증 게이트, NIST 100‑4 투명성 표준 준수(출처/버전/타임스탬프 자동기록).
OWASP Foundation
+2
OWASP Foundation
+2

S(Scale): 성능/비용/안전성 SLO로 스케일, 실패패턴(“중단”) 자동 티켓팅.

KPI (예시, 2‑dec)

Inv‑OCR 필드정확도 ≥ 98.00%, 수정TAT ≤ 0.50 h

HSRisk 오분류 ≤ 0.50%, 인증(ECAS/FANR) 누락 0건
Ministry of Industry
+1

DEM/DET 예측오차(MAPE) ≤ 5.00%

Heat‑Stow 위반건 0/vsl, 재배치 시간 ≤ 0.25 h

6) 도메인 전용 Prompt 스니펫(구조화 출력 강제)
6.1 HSRisk + CertChk (MoIAT/FANR)

Deliver JSON only conforming to schema. If info is missing, set evidence=[] and risk_note="MISSING".

{
  "$schema": "https://…/hs_risk.schema.json",
  "hs_code": "####.##.##",
  "incoterm": "CIP",
  "country": "AE",
  "controls": ["MoIAT-ECAS","FANR-REG09"],
  "evidence": [{"title":"…","url":"…"}],
  "risk_level": "HIGH|MEDIUM|LOW",
  "risk_note": "…"
}


근거 링크는 MoIAT(ECAS/G‑Mark)·FANR(Reg‑09/Permit) 우선 인용.
Ministry of Industry
+2
Ministry of Industry
+2

6.2 Heat‑Stow(컨테이너 온도/접근성/IMDG)

ReAct step plan: “check‑IMDG → check‑temp‑class → check‑stack‑position → propose‑swap → self‑critique”.

Output: {"violations":[...], "swap_suggestion":[...], "eta_min":12.50}

6.3 Invoice‑OCR→Audit

PAL/PoT: 금액·통화·세율을 코드로 재계산, 원본 값과 차이를 delta로 표시.
arXiv
+1

7) 자동화(LLM+RPA+Sheets) & Slash‑Cmd

/logi-master --fast hs-risk
→ HS 후보 3개 + Self‑Consistency로 다수결, CRAG 평가<0.60이면 재검색.
arXiv
+1

/logi-master certchk --aedonly
→ MoIAT ECAS/G‑Mark & FANR Permit 체크리스트 JSON.
Ministry of Industry
+1

/logi-master heat-stow --noheatmap
→ ToT 탐색 결과만 JSON(배치·교환안·위반근거).
arXiv

/logi-master invoice-audit --deep
→ PAL/PoT 코드산식으로 계산값 검증·차이표.
arXiv

8) QA / Gap‑recheck (운영 체크리스트)

근거·버전: 논문/공식문서 링크, 수집시각 기록(UTC). (OpenAI Structured Outputs로 스키마 강제)
OpenAI

보안: 입력살균(시스템프롬프트/키 노출 방지), 출력검증(정책·정규식), 간접주입 방어 룰. OWASP LLM01 준수.
OWASP Gen AI Security Project

평가: Promptfoo 회귀·레드팀을 PR 게이트에 연결(CI).
Promptfoo

9) Fail‑safe Log (“중단” 테이블 + ZERO)
단계	트리거	조치	재개조건
ZERO‑STOP	증거<2건·인용불일치	응답중단 + “NEED‑EVIDENCE” 코드	증거≥2, 최신성≤90d
DATA‑MISMATCH	OCR합계≠산식결과	PAL 재계산→오차>0.50%면 보류	승인자 수기확인
COMPLIANCE‑GAP	MoIAT/FANR 누락	certchk 재실행→링크검증	링크 200 OK/적합
10) Changelog (v3.4→v3.6)

신규: CRAG/Self‑RAG, Structured Outputs 강제, DSPy/LangGraph, OWASP LLM Top‑10(2025) 준수.
OWASP Foundation
+5
arXiv
+5
arXiv
+5

강화: CoT→Self‑Consistency 기본화, ToT·PAL/PoT 도입, Promptfoo 도입.
GitHub
+3
arXiv
+3
arXiv
+3

11) 바로 쓰는 Prompt 패턴(짧게)

“RAG‑with‑CRAG(HS Code)”
System: Answer with JSON(schema:hs_risk).
User: Give HS candidates(3) for …, cite MoIAT/FANR pages. If evaluator<0.60, retry retrieval with rewritten query.
arXiv

“Reflexion‑Invoice‑Audit”
System: Run PAL to recompute totals; if delta>0.5%, add fix_memo and stop.
arXiv
+1

“ToT‑Heat‑Stow”
System: Explore placements as thoughts(max 5), evaluate by IMDG & temp rules, output top‑1 JSON only.
arXiv

참고(핵심 출처)

Prompt Engineering 서베이/기법 총정리, 2024.
arXiv
+1

RAG Best‑Practices(EMNLP 2024).
ACL Anthology

ReAct / Reflexion / ToT / PAL·PoT.
arXiv
+3
arXiv
+3
GitHub
+3

CRAG(2024) / Self‑RAG(2023).
arXiv
+1

Structured Outputs(OpenAI) / Outlines / Guidance.
OpenAI
+2
GitHub
+2

DSPy / LangGraph.
GitHub
+1

OWASP LLM Top‑10(2025) / NIST AI 100‑4·600‑1.
OWASP Foundation
+2
OWASP Foundation
+2

MoIAT(ECAS/G‑Mark) / FANR(Reg‑09/Permit).
Federal Authority for Nuclear Regulation
+3
Ministry of Industry
+3
Ministry of Industry
+3

12) CmdRec (Top‑3)

/logi-master --fast hs-risk → JSON Schema 결과 + 인용 + CRAG 스코어

/logi-master certchk --aedonly → MoIAT/FANR 체크리스트 자동화

/logi-master heat-stow --deep → ToT 탐색·위반근거·교환안

필요하면 사내 데이터 스키마(JSON) 초안까지 바로 그려서 연결하겠습니다. 지금 상황에서 바로 효과 볼 건 **A안(PE‑Lite)**부터 굴리는 것—짧게, 뚜렷하게, 측정 가능하게.
